# Debug Recording Azure Storage Support - Summary

## ‚úÖ What Was Added

I've updated the `save_debug_recording()` method in `/Users/jp/Documents/MaestroLabs/attendee/bots/bot_controller/bot_controller.py` to support uploading debug recordings to Azure Storage alongside the existing AWS S3 functionality.

## üîÑ How It Works Now

### Original Behavior (Preserved)
The debug recording is still saved to Django's default storage backend (AWS S3) using the existing `BotDebugScreenshot` model. This ensures:
- ‚úÖ Database records are maintained
- ‚úÖ Existing functionality works unchanged
- ‚úÖ Django admin interface still works
- ‚úÖ API endpoints still function

### New Enhanced Behavior (Added)
After saving to Django storage, the system now also:
1. **Creates a UnifiedStorageManager** instance with the debug recording filename
2. **Checks configured storage providers** (AWS S3, Azure Storage, or both)
3. **Uploads to all configured providers** based on `STORAGE_UPLOAD_MODE` environment variable
4. **Provides detailed logging** for each upload attempt
5. **Handles errors gracefully** - if unified storage fails, the original Django storage still works

## üìÅ File Organization

### Debug Recording Filename Pattern
```
debug_screen_recording_{object_id}.mp4
```
Where `object_id` is a unique 16-character identifier generated by the `BotDebugScreenshot` model.

### Storage Locations

#### AWS S3 (Original)
- **Bucket**: Determined by `AWS_RECORDING_STORAGE_BUCKET_NAME`
- **Path**: `/debug_screen_recording_{object_id}.mp4`
- **Access**: Via Django file storage and admin interface

#### Azure Storage (New)
- **Container**: Determined by `AZURE_STORAGE_CONTAINER_NAME`  
- **Blob Name**: `debug_screen_recording_{object_id}.mp4`
- **Access**: Via Azure Storage Explorer or Azure portal

## üéõÔ∏è Configuration

The debug recording upload behavior follows the same environment variables as main recordings:

### AWS S3 Only (Default)
```bash
STORAGE_UPLOAD_MODE=s3  # or omit (defaults to s3)
```
- Django storage ‚Üí AWS S3
- Unified storage ‚Üí AWS S3 (same file, uploaded twice for redundancy)

### Azure Storage Only
```bash
STORAGE_UPLOAD_MODE=azure
```
- Django storage ‚Üí AWS S3 (still happens for database consistency)
- Unified storage ‚Üí Azure Storage

### Both AWS S3 and Azure Storage
```bash
STORAGE_UPLOAD_MODE=both
```
- Django storage ‚Üí AWS S3
- Unified storage ‚Üí AWS S3 + Azure Storage (total: 2 copies in AWS, 1 in Azure)

## üìä Upload Flow Example

```
Bot finishes meeting
‚Üì
cleanup() called
‚Üì 
save_debug_recording() called
‚Üì
Debug file exists? ‚Üí Yes
‚Üì
Create BotDebugScreenshot record
‚Üì
Save to Django storage (AWS S3) ‚Üí Success
‚Üì
Create UnifiedStorageManager
‚Üì
Check STORAGE_UPLOAD_MODE=both
‚Üì
Upload to AWS S3 ‚Üí Success ‚úÖ
‚Üì  
Upload to Azure Storage ‚Üí Success ‚úÖ
‚Üì
Log: "Unified storage manager finished uploading debug recording to all providers"
```

## üîç Logging Output Examples

### Successful Dual Upload
```
INFO: Saved debug recording with ID shot_abc123def4567890
INFO: Starting unified storage upload for debug recording: debug_screen_recording_shot_abc123def4567890.mp4
INFO: Uploading debug recording to configured providers: AWS S3, Azure Blob Storage
INFO: Successfully uploaded debug recording to AWS S3
INFO: Successfully uploaded debug recording to Azure Blob Storage  
INFO: Unified storage manager finished uploading debug recording to all providers
```

### Azure Storage Only
```
INFO: Saved debug recording with ID shot_xyz789ghi0123456
INFO: Starting unified storage upload for debug recording: debug_screen_recording_shot_xyz789ghi0123456.mp4
INFO: Uploading debug recording to configured providers: Azure Blob Storage
INFO: Successfully uploaded debug recording to Azure Blob Storage
INFO: Unified storage manager finished uploading debug recording to all providers
```

### No Additional Storage Configured
```
INFO: Saved debug recording with ID shot_def456jkl7890123
INFO: Starting unified storage upload for debug recording: debug_screen_recording_shot_def456jkl7890123.mp4  
INFO: No additional storage providers configured for debug recording - using Django default storage only
```

### Error Handling
```
INFO: Saved debug recording with ID shot_mno123pqr4567890
INFO: Starting unified storage upload for debug recording: debug_screen_recording_shot_mno123pqr4567890.mp4
ERROR: Failed to upload debug recording to Azure Blob Storage
ERROR: Error uploading debug recording with unified storage manager: ConnectionError(...)
```

## ‚úÖ Benefits

1. **Backup Redundancy**: Debug recordings stored in multiple locations
2. **Geographic Distribution**: Can store in different Azure regions
3. **Cost Optimization**: Can choose different storage tiers (Hot/Cool/Archive)
4. **Compliance**: Meet data residency requirements 
5. **Disaster Recovery**: Multiple independent storage systems
6. **Graceful Degradation**: If one storage fails, others still work

## üöÄ Ready to Use

The debug recording Azure Storage support is now fully integrated and will automatically:
- ‚úÖ Work with your existing Kubernetes secrets (`AZURE_STORAGE_*` variables)
- ‚úÖ Respect the `STORAGE_UPLOAD_MODE` environment variable
- ‚úÖ Maintain all existing functionality
- ‚úÖ Provide comprehensive logging for debugging
- ‚úÖ Handle errors gracefully without breaking the bot lifecycle

Your debug recordings will now be uploaded to Azure Storage alongside the main meeting recordings! üéâ