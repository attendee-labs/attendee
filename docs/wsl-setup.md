# Running Attendee on WSL (Without Docker)

This guide explains how to run the Attendee project directly on WSL (Windows Subsystem for Linux) without using Docker.

## Prerequisites

- Windows 10/11 with WSL2 installed
- Ubuntu 22.04 (recommended) or similar distribution on WSL
- At least 4GB of available RAM
- AWS credentials (for S3 storage) - optional for basic testing

## Quick Start

```bash
# 1. Clone the repository (if you haven't already)
git clone https://github.com/attendee-labs/attendee.git
cd attendee

# 2. Run the setup script
chmod +x scripts/wsl_setup.sh
./scripts/wsl_setup.sh

# 3. Set up the database
./scripts/setup_db.sh

# 4. Create and activate virtual environment
python3 -m venv venv
source venv/bin/activate

# 5. Install Python dependencies
pip install -r requirements.txt
pip uninstall -y av && pip install --no-binary av "av==12.0.0"

# 6. Generate environment file
python init_env.py > .env
# Edit .env to add your AWS credentials (optional)

# 7. Run database migrations
export DJANGO_SETTINGS_MODULE=attendee.settings.local
python manage.py migrate

# 8. Start all services
./scripts/run_local.sh
```

## Detailed Setup Steps

### Step 1: Install System Dependencies

Run the automated setup script:

```bash
./scripts/wsl_setup.sh
```

This installs:
- Python 3.10 and pip
- PostgreSQL 15
- Redis
- Google Chrome and ChromeDriver
- Audio dependencies (ALSA, PulseAudio, FFmpeg)
- GStreamer
- Build tools and libraries

### Step 2: Set Up PostgreSQL Database

```bash
# Start PostgreSQL service
sudo service postgresql start

# Run the database setup script
./scripts/setup_db.sh
```

Or manually:

```bash
sudo -u postgres psql -c "CREATE USER attendee_development_user WITH PASSWORD 'attendee_development_user';"
sudo -u postgres psql -c "CREATE DATABASE attendee_development OWNER attendee_development_user;"
sudo -u postgres psql -c "ALTER USER attendee_development_user CREATEDB;"
```

### Step 3: Set Up Python Environment

```bash
# Create virtual environment
python3 -m venv venv

# Activate it
source venv/bin/activate

# Install dependencies
pip install -r requirements.txt

# Install av with proper video support
pip uninstall -y av && pip install --no-binary av "av==12.0.0"
```

### Step 4: Configure Environment Variables

Generate the environment file:

```bash
python init_env.py > .env
```

Edit `.env` and add your credentials:

```bash
CREDENTIALS_ENCRYPTION_KEY=<auto-generated>
DJANGO_SECRET_KEY=<auto-generated>
AWS_RECORDING_STORAGE_BUCKET_NAME=your-bucket-name
AWS_ACCESS_KEY_ID=your-access-key
AWS_SECRET_ACCESS_KEY=your-secret-key
AWS_DEFAULT_REGION=us-east-1
```

**Note:** AWS credentials are optional for basic development. The app will work without them, but recording storage features won't function.

### Step 5: Run Database Migrations

```bash
export DJANGO_SETTINGS_MODULE=attendee.settings.local
python manage.py migrate
```

### Step 6: Create a Superuser (Optional)

```bash
python manage.py createsuperuser
```

### Step 7: Start the Application

**Option A: Start all services together**

```bash
./scripts/run_local.sh
```

This starts:
- Django development server (port 8000)
- Celery worker (background tasks)
- Celery scheduler (scheduled tasks)

**Option B: Start services individually (in separate terminals)**

Terminal 1 - Start PostgreSQL and Redis:
```bash
./scripts/start_services.sh
```

Terminal 2 - Django server:
```bash
./scripts/run_server.sh
```

Terminal 3 - Celery worker:
```bash
./scripts/run_worker.sh
```

Terminal 4 - Celery scheduler:
```bash
./scripts/run_scheduler.sh
```

## Accessing the Application

- **Main application:** http://localhost:8000
- **API documentation:** http://localhost:8000/api/v1/
- **Admin panel:** http://localhost:8000/admin/

## Available Scripts

| Script | Description |
|--------|-------------|
| `scripts/wsl_setup.sh` | Install all system dependencies |
| `scripts/setup_db.sh` | Create PostgreSQL database and user |
| `scripts/start_services.sh` | Start PostgreSQL and Redis |
| `scripts/run_local.sh` | Start all services (Django + Celery) |
| `scripts/run_server.sh` | Start Django server only |
| `scripts/run_worker.sh` | Start Celery worker only |
| `scripts/run_scheduler.sh` | Start Celery scheduler only |

## Troubleshooting

### PostgreSQL won't start

```bash
# Check PostgreSQL status
sudo service postgresql status

# Start PostgreSQL
sudo service postgresql start

# If that fails, check logs
sudo tail -f /var/log/postgresql/postgresql-*-main.log
```

### Redis won't start

```bash
# Check Redis status
redis-cli ping

# Start Redis
sudo service redis-server start

# If that fails
sudo service redis-server restart
```

### Permission denied errors

Make sure scripts are executable:

```bash
chmod +x scripts/*.sh
```

### Chrome/ChromeDriver issues

If you see Chrome-related errors:

```bash
# Check Chrome version
google-chrome --version

# Check ChromeDriver version
chromedriver --version

# They should match (e.g., both 134.x)
```

### Database connection errors

1. Ensure PostgreSQL is running: `sudo service postgresql start`
2. Check connection: `psql -h localhost -U attendee_development_user -d attendee_development`
3. Verify settings in `.env` match your database configuration

### Import errors

Make sure you're using the virtual environment:

```bash
source venv/bin/activate
which python  # Should show path to venv/bin/python
```

## Differences from Docker Setup

| Feature | Docker | WSL (Local) |
|---------|--------|-------------|
| Settings module | `attendee.settings.development` | `attendee.settings.local` |
| PostgreSQL host | `postgres` (container) | `localhost` |
| Redis URL | `redis://redis:6379/5` | `redis://localhost:6379/5` |
| Service management | Docker Compose | systemd / manual |

## Notes

- The `attendee.settings.local` module is specifically configured for running without Docker
- Services must be started manually on each WSL session (PostgreSQL, Redis)
- Logs are stored in the `logs/` directory when using `run_local.sh`
- Press `Ctrl+C` in the terminal running `run_local.sh` to stop all services
